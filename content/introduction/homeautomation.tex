\section{Smart Homes}\label{sec:smarthomes}
%Thalley: Indf√∏r noget statistik over smart homes?
However, that is a rather extreme example of a smart home. 
The devices found in smart homes are common items that has been connected to the Internet for wireless control.
Common devices that are found in smart homes include, but are not limited to, 
windows, HVAC, thermostats, sound systems and locks. 
However, only few devices have really gained ground for the common user and few homes are automated.
One of the most commonly found IoT in homes is the Nest thermostat \cite{NEST}. 
This thermostat senses when you are around, and when you are not, 
to control the climate inside to save energy and thus money.
Unlike a lot of smart devices that are made to make your life a little easier, such as smart bulbs,
the Nest thermostat helps you save money which is likely the reason for it popularity. 
Furthermore, the newest version (as of October 2015) allows you to connect other IoT devices to the thermostat. 
The Nest thermostat is thus starting to solve what is likely the greatest problem with smart homes (and IoT in general), 
and why they have not become popular yet: lack of interoperability between IoT devices. 
This problem leads us to what is known as smart hubs. 

\subsection{Smart Hubs}
A smart hub is a device, or service, that implements several communication protocols used by IoT devices, 
and gives the user a single protocol or interface. 
The goal of a smart hub is to make the connected devices able to communicate.
The communication problem arises from the number of different communication protocols used by the smart devices. 


\subsubsection{Common Protocols for Home Automation}
There is a range of different protocols that are being used for various smart devices. 

%Thalley: Figure is removed for now
%\Cref{fig:IoTProtocols} illustrates the current architecture of the IoT network,
%where \num{5} communication protocols are shown. 

%\begin{figure}[!htb]
%    \centering
%    \input{drawings/IoTArchitecture.tikz}
%    \caption{Architecture of IoT network}
%    \label{fig:IoTProtocols}
%\end{figure}

We will not get into much detail with these protocols, 
but we demonstrate how many different there are and why communication is a problem.
\begin{table}
   \begin{description}
       \item[Protocol:] ZigBee
       \item[Used by:] Samsung, Jasco, Smartenit, FortrezZ and others
       \item[In products:] SmartThings Hub, thermostats, door sensors, light bulbs, etc.\\
       
       \item[Protocol:] Z-Wave
       \item[Used by:] FortrezZ, GE, Intermatic, Leviton, Aeon Labs, Evolve and others
       \item[In products:] Thermostats, wall outlets, door locks, door and window sensors, etc.  \\
       
       \item[Protocol:] WiFi (IEEE 802.11)
       \item[Used by:] Nest, Philips, Samsung, Bose, D-link and others
       \item[In products:] Thermostats, speakers, light bulbs, motion sensors, fitness trackers, camera, etc. 
    \end{description}
    \caption{Protocols used by various IoT devices}\label{table:iotprotocols}
\end{table}

Aside from the protocols in \Cref{table:iotprotocols}, 
there are several others messaging protocols such as MQTT, CoAP and XMPP used by various devices. 

A smart hub should thus not only be able to communicate with the devices, 
but also be able to transform the data to a single format and give easy access to it.

\subsubsection{Analysis of a Smart Hub: HomePort}
In this section we will analyze a smart hub called \emph{HomePort} \cite{HOMEPORT10}.
HomePort is not a commercial smart hub, 
but is a research project at Aalborg University. 
The reason why we are analyzing this smart hub, 
is that is it described in a way that commercial smart are not (either due to secrecy or simply lack of information) \cite{HOMEPORT09, HOMEPORT10, HOMEPORT13}.  

HomePort is technically a system, or rather an architecture, rather than a hub. 
The architecture is described in \cite{HOMEPORT10}. 
However, an implementation of this, \ie an actual smart hub, can be found in \cite{HOMEPORT13}. 
The architecture consists of \num{4} layers as illustrated by \Cref{fig:homeport}.

\begin{figure}[!htb]
    \centering
    \input{drawings/homeport.tikz}
    \caption{The HomePort architecture proposed in \protect\cite{HOMEPORT10}}
    \label{fig:homeport}
\end{figure}

The layers have the following functionality:
\begin{description}
    \item[(1) Device Layer] This layer consists of the smart devices connected to easy subsystem (\eg ZigBee or Z-wave). Devices in different subsystems can usually not communicate with each other.
    \item[(2) Bridging Layer] This layer relays commands from one subsystem to another using minimum translation or adaption of the subsystem protocols. Commands are sent to a \emph{bridge device}, which then replies on behalf of the other devices. The layer consists of two parts: a generic bridging part and a subsystem dependent part. 
    \item[(3) Service Layer] This layer provides the composition layer with device functionality using a common language. A Gateway device is introduced to give access to the Bridge devices. This Gateway device communicates using a RESTful interface. 
    \item[(4) Composition Layer] The composition layer lets applications use multiple home devices to create a smart home, by communicating with the different Bridge devices through the common language from the service layer. 
\end{description}

The implementation of HomePort modified a few things about this architecture, 
and added additional components such as a logging system. 
An illustration of the implemented system can be seen in \Cref{fig:homeport2}.
The implementation runs on a Linux server and uses ZeroConf to discover services on the network. 
Clients (\eg applications) communicate with the smart devices through HomePort. 
The clients can get a list of devices in the system by sending a \texttt{GET} request, 
which also returns the services they provide. 

\begin{figure}[!htb]
    \centering
    \input{drawings/homeport2.tikz}
    \caption{The HomePort architecture implemented in \protect\cite{HOMEPORT13}}
    \label{fig:homeport2}
\end{figure}

Following is a short description of the HomePort system showed in \Cref{fig:homeport2}:
\begin{description}
    \item[Webserver] Provides a RESTful interface to access and control the services.
    \item[ZeroConf] A service discovery module that discovers devices inside a Local Area Network (LAN).
    \item[Log] The log module keeps trace of requests and events. 
    \item[HomePort Services] Keeps information about the services. 
    \item[HomePort Secure Services] Adds security through TLS to the HTTP requests (HTTPS).
    \item[HomePort Access Control Service] This module contains a table of information about what each client is allowed to do. 
    \item[Events Module] Sends notifications to devices and handles requests from clients
    \item[Configuration] Stores configuration of HomePort. HomePort can be configured to use only HTTP, a mix of HTTP and HTTPS or only HTTPS.
    \item[Adapter] The adapters handles the translation between devices. 
\end{description}

HomePort uses, as mentioned, a RESTful interface for communication. 
In order to get the devices in the HomePort network, 
we can do a \texttt{GET} request on \texttt{/devices}.
The output is an XML file containing information about the devices,
such as ID and what actions can be performed,
or rather what values the devices can have (\eg 0 = off, and 1 = on).
Each device also has a URL. 
This URL is used to control the devices. 

Following is an example of how to turn on a lamp in HomePort.
In this example, the lamp is connected to a Phidgets\footnote{\url{http://www.phidgets.com/}} network, 
where HomePort is connected to a Phidgets interface kit with ID 173111, 
using a Phidgets adapter. 
We want to change the \emph{output} of the lamp with ID 0, 
to the value 1. 
To change the value of the lamp, 
we have to send the following data to it:

\begin{listing}
  \begin{minted}{xml}
    <?xml version='1.0' encoding='UTF-8'?><value>1</value>
  \end{minted}
  \caption{Data to send to a HomePort devices, to set the value of the device to 1}
  \label{lst:homeportchange}
\end{listing}

The data is sent as a \texttt{PUT} request with the URL of the lamp, 
which in this example is \texttt{/phidget/173111/output/0}. 
The URL describes that we want to change the output of device with ID 0, 
of the interface with ID 173111 of the Phidgets network, to the value 1.

From what we have seen so far with HomePort, 
it shows that only a part of the smart hub's responsibility is the translation between the different protocols. 
The smart hub should also handle requests from clients (\eg using a RESTful interface), 
and preferably also provide secure communication. 

\subsubsection{Smart Hubs on the Market}
The requirements for smart hubs have gained the attention of several large companies and even more smaller companies, 
all competing to be center of future smart homes. 
One of the mature commercial available smart hubs is the Samsung SmartThings Hub \cite{SMARTTHINGS}. 
The SmartThings Hub is a standalone device that supports the Z-Wave, ZigBee and WiFi protocols, 
and provides a smartphone application or a Representational State Transfer (REST) interface. 
The SmartThings Hub has been tested and is compatible with more than 150 devices as of October 2015,
but with support for the aforementioned protocols and a REST interface, this number is in practice higher.  
The price for such a hub is \$99, which is, compared to the prices for some of the compatible devices, very affordable. 

Samsung is, however, not the only company selling smart hubs. 
Microsoft has been working on their HomeOS \cite{HOMEOS} and Apple has their HomeKit \cite{HOMEKIT}.
While these products differ in terms of architecture, descriptions (operating system contra hub) and availability,
they all share the same goal of giving a centralized control of smart devices. 

There are also other open source alternatives such as openHAB \cite{OPENHAB}, 
where you simply setup your own server running the open sourced code and control the devices through that. 
The advantage here is of course the price (free) and the possibility of adding new unsupported products. 

\Cref{table:smarthubs} gives a short overview of some of the available or coming smart hubs. 
\todo[author=Thalley]{Add HomePort to this section}
\begin{table}
    \centering
    \begin{tabular}{l l}
        Company                           & Product Type \\ \hline
        openHAB \cite{OPENHAB}             & Employ open source code on own server \\
        Open Source Automation \cite{OSA}  & Employ open source code on own server \\
        OpenRemote \cite{OPENREMOTE}       & Employ open source code on own server \\
        Apple \cite{HOMEKIT}               & HomeKit Framework \\
        Samsung \cite{SMARTTHINGS}         & SmartThings Hub: A standalone device that costs \$99 \\
        Microsoft \cite{HOMEOS}            & HomeOS: An operating system that runs on a server
    \end{tabular}
    \caption{An overview of home automation hubs from different companies}
    \label{table:smarthubs}
\end{table}

\subsection{Control of Smart Homes}\label{sec:smarthomecontrol}
While smart hubs let different smart devices communicate, 
they are not meant to be a control panel for smart homes (although some, such as HomeOS, is designed as such).
To control the devices connected to a smart home, or standalone smart devices, 
most vendors offer some sort of smartphone application that gives the consumer a basic interface to control the device, set rules for it and so on.
This is for example the case with the Samsung SmartThings hubs. 

An alternative to such an application could be the Logitech Harmony Remote \cite{HARMONYREMOTE}, 
which is a universal remote that can connect to over \num{270000} devices (smart and dumb). 
It comes either as a standalone remote control or connected with a hub. 
Depending on the model, the remote either uses infrared (does not require a hub), 
or connects to a hub via WiFi. 

Gesture control is a newer and more advanced way of controlling a smart home. 
A company known as Reemo \cite{Reemo}, formerly Playtabase, has created a way of controlling smart devices by gestures. 
They have developed a wearable device which is located on the wrist. The wearable allows user to point at a device, 
and then perform a pre-programmed gesture that corresponds to a certain action for that device. 
A small receiver has to be placed near the devices that you want to control. The receiver must be pointed at as depected in figure \ref{fig:reemo}.
The pointing will, however, only work if the device is within line of sight. 

%Thalley: Skal vi bare skrive ``Reemo'' i stedet for en url som source?
\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.8\textwidth]{images/Reemo}
    \caption{How Reemo gesture control works. Source: \url{http://www.getreemo.com/projects/}}
    \label{fig:reemo}
\end{figure}

Unfortunately they have not disclosed any details regarding the technology, 
how the receivers know which receiver you are pointing at or how the devices are controlled. 
The company and the product is also still in a development phase, 
so the product is not commercialized yet but have been in development since mid-2014.

These are the most common and/or most intuitive ways of controlling smart devices. 
The question is which is ``the best'', or rather, which method is the wanted way of controlling the devices.
\Cref{tbl:smartcontrol} summaries the aforementioned 3 ways. 

\begin{table}[!htb]
    \centering
    \parbox[t][][t]{0.3\textwidth}{
        \textbf{Smartphone Application}\\
        \textbf{Pros:} Easy control of smart devices if the smartphone is usually carried or always near. 
                       Applications are usually available from vendors. 
                       Easy to get updates to the software. \\
        \textbf{Cons:} Requires a smartphone nearby to control. 
                       An overhead of unlocking phone, opening application and selecting device and action.
    }\quad
    \parbox[t][][t]{0.3\textwidth}{
        \textbf{Remote Control}\\
        \textbf{Pros:} Easy control of smart devices if the remote is usually carried or always near. \\
        \textbf{Cons:} Requires a remote control nearby to control (usually not very expensive). 
                       An overhead of selecting device and action.
    }\quad
    \parbox[t][][t]{0.3\textwidth}{
        \textbf{Gesture Control}\\
        \textbf{Pros:} Wearables are usually worn and grants easy control of applications by gesture.
                       Intuitive way of controlling devices (gestures imitates regular actions).
                       Easy to get updates to the software. 
                       No overhead of opening an application\\
        \textbf{Cons:} Requires a wearable to control. 
                       Have to remember gestures.
                       Must be in line of sight of the user.
    }
    \caption{Ways of controlling smart devices}
    \label{tbl:smartcontrol}
\end{table}

Each way has its pros and cons. 
A survey of 37 people showed that \perc{76} found gestures to be a natural way of controlling devices, 
while \perc{8} found it unnatural and the remaining left the question unanswered \cite{Kela2006}. 
This survey shows that users would rather have gesture for control, 
rather than the bother of always using their smartphone or remote for control.  
A product such as Reemo is a one way of controlling smart devices but it has a downside that the objects have to be in line of sight. 
If this restriction could be removed, the system would be improved.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../master"
%%% End:
