\section{Scheduling}\label{sec:desScheduling}
Since we rely on flexible consumption and because it is possible to forecast production, we can schedule the flexible consumption to match the forecasted production. Flexible consumption is consumer energy consumption that is not necessarily needed right now. The goal of scheduling is to move this type of energy consumption below the produced energy, as shown in \Cref{sec:solapproach} and thus increase the profit for the BRP by not needing to purchase energy unless required. The flexible consumption in is purely based on charging of electric vehicles.  

\input{content/design/scheduling/idea}

Below we introduce the scheduling techniques that are candidates for solving this optimization problem, and propose a design of each chosen scheduling approach based on the techniques. To benefit from the flexible consumption of energy, given EVs that are available for flexible consumption, we can plan the way that EVs are charged, such that imbalances are minimized and all EVs are \var{minCharged} by their deadlines. 

\subsection{No Scheduling}\label{sec:nosched}
While not a model, no scheduling is the baseline, control group option. The current real world approach is not to do any scheduling of consumption, which, as we have shown, has its issues. 

Charging of each EV will simply happen as soon as it is plugged in until it is plugged out or charged to the battery's limit, taking none of the data structures above into account. This method poses a problem, because during low demand periods such as during the night, wind energy production will risk going to waste, because there simply is no use for it, as the EVs will already have been charging all night. 

\subsection{Scheduling with Linear Programming}\label{sec:lpsched}
The optimization problem described in \Cref{sec:idea} is a linear programming problem. Linear programming (LP) is a mathematical optimization technique for optimization of a linear objective function, subject to linear constraints. LP finds the \emph{optimal} solution to the objective function, being global maximum or global minimum within a feasible region. LP is interesting to analyze because it guarantees to find the optimal solution and also is very relevant to the problem described above. For LP to work, a linear objective function and linear constraints are required, as the objective function is the function that will be optimized. Our objective function is repeated here for accessibility:

\begin{equation}\label{eq:lpprob}
  \mathop{f}(x) = \sum_{t \ass 1}^x \left(\var{EU}_t \cdot \var{EUP}_t + \var{EE}_t \cdot \var{EEP}_t - \var{EI}_t \cdot \var{EIP}_t\right) 
\end{equation}

The table of charge-offers and energy prices are also supplied as input, but are static variables. The parameter $x$ is the series of time slots desired to schedule for based on the static parameters. This function is linear because it satisfies the properties of additivity and homogeneity. Additivity holds because if you have 72 time slots of length \SI{20}{\minute} in a day, then $\mathop{f}(1 + 2) = \mathop{f}(1) + \mathop{f}(2)$, due to the fact that computing profit for time slots one and two together gives the same results as computing them individually. Additivity also implies homogeneity in our case.

All the constraints described above also fit the canonical form of a LP problem, again making it trivial to transfer it to a solver.  We do not concentrate on the direct implementation of a LP solution, since many different kinds of solvers exist as off the shelf products. To make the optimization problem compatible with our idea of scheduling, the LP scheduler would work in the following three basic steps: 

\begin{enumerate}
  \item Generate input table of charge-offers and maximum charging speeds like \Cref{tab:unsched}
  \item With the input table as input, run an LP-solver that solves \Cref{eq:lpprob}
  \item Interpret output of LP-solver as a charge-plan
\end{enumerate}

The use of LP ensures that the requirements of the charge-offers are met, e.g.\ all EVs receive the energy they need before their deadlines. It also maximizes the amount of RES we use, charging as many EVs as possible if we have a lot of production. Meanwhile it minimizes energy imports, if energy imports are needed the energy will be imported in the time slots that are cheapest, all whilst taking every EV's deadline into account.

\subsubsection{Zero-one Integer Problems}
The problem solved by the objective function in \Cref{eq:opprob} has an unknown binary variable. This means the nature of the optimization problem is a zero-one integer linear programming problem. Solving zero-one integer linear problems is much more expensive in time than solving ordinary linear problems, where integers are considered as continuous. In fact, zero-one integer programming problems have been proven to belong to the complexity class NP~\cite{Karp72}.

We can therefore conclude that the optimization problem described in \Cref{eq:opprob} is NP-complete, getting the optimal solution to the scheduling problem is not realistic. However, a LP-solver can still be used to aid us in solving the problem. In order to speed up the solving of our mixed integer linear programming problem, the binary constraint can be changed to be a continuous constraint, meaning that the unknown binary variable can instead be in the range between $0$ and $1$. Then the values of the intermediate matrix will have to be rounded to either zero or one, while ensuring the constraints are held. When rounding, it can no longer be ensured that the given output is an optimal solution, but it reduces the problem to a normal linear programming problem which are much easier to solve, i.e.\ complexity class P~\cite{LPMS}. 

\subsubsection{Linear Programming Complexity}
Following the steps in the above list, there technically exists three completely different time complexities relating to the input table, running the solver, and translating the output of that usable charge-plan back to something the system can comprehend. Step 1 and 3 are straightforward, as they simply iterate over all charge-offers for each time slot. 

The dominating step of the three steps is Step 2, since Step 2 is to solve a zero-one integer problem. Step 2 is in the complexity class NP, and its input size is the number of charge-offers times the number of time slots. Since the complexity of calling a LP tool is far greater than generating the input and reading back the output, the total worst case complexity of the LP scheduler is equal to the worst case complexity of the external tool.

\input{content/design/scheduling/greedy}

\subsection{Discussion}
An LP solution approach is the optimal approach to solving such an optimization problem. We however choose to implement the LP solution with rounding, using software tool designed to solve linear optimization problems. This approach will be more time efficient, but it cannot be guaranteed that the output is optimal. We choose to also implemented a greedy scheduler so that we can compare the results of different scheduling methods with the results of no scheduling. We decide not to design a randomized greedy scheduler, because it does not guarantee a good solution. We will not implement any other solutions because we will not have time to implement them properly. 

We will evaluate these methods with regards to the quality of the scheduling and with regards to their performance in \Cref{chap:evaluation}.
